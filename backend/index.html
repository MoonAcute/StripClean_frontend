<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Metadata Analyzer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      width: 100%;
      max-width: 900px;
      margin: 24px;
      padding: 24px;
      border-radius: 16px;
      background: rgba(15, 23, 42, 0.95);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }

    h1 {
      margin-top: 0;
      font-size: 1.8rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h1 span.logo {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 20%, #22d3ee, #6366f1);
    }

    p.subtitle {
      margin-top: 4px;
      color: #9ca3af;
      font-size: 0.95rem;
    }

    .card {
      margin-top: 20px;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: #020617;
    }

    .upload-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    input[type="file"] {
      padding: 8px;
      background: #020617;
      color: #e5e7eb;
      border-radius: 8px;
      border: 1px dashed #4b5563;
      cursor: pointer;
      max-width: 320px;
    }

    button {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.35);
      transition: transform 0.08s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 14px 30px rgba(34, 197, 94, 0.45);
    }

    .status {
      margin-top: 10px;
      font-size: 0.9rem;
    }

    .status.error {
      color: #fca5a5;
    }

    .status.ok {
      color: #6ee7b7;
    }

    .section-title {
      font-size: 1.1rem;
      margin-bottom: 8px;
      margin-top: 0;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }

    .info-item {
      padding: 10px;
      border-radius: 10px;
      background: #020617;
      border: 1px solid rgba(75, 85, 99, 0.7);
      font-size: 0.9rem;
    }

    .info-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .info-value {
      font-size: 0.95rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge-danger {
      background: rgba(248, 113, 113, 0.15);
      border: 1px solid rgba(248, 113, 113, 0.5);
      color: #fecaca;
    }

    .badge-warn {
      background: rgba(234, 179, 8, 0.1);
      border: 1px solid rgba(234, 179, 8, 0.6);
      color: #facc15;
    }

    .badge-ok {
      background: rgba(22, 163, 74, 0.1);
      border: 1px solid rgba(22, 163, 74, 0.7);
      color: #bbf7d0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      font-size: 0.86rem;
    }

    thead {
      background: #020617;
    }

    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid rgba(55, 65, 81, 0.7);
      vertical-align: top;
    }

    th {
      text-align: left;
      color: #9ca3af;
      font-weight: 500;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    tr:nth-child(even) td {
      background: rgba(15, 23, 42, 0.8);
    }

    .tag-name {
      font-weight: 600;
      color: #e5e7eb;
    }

    .sensitive-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.72rem;
      background: rgba(248, 113, 113, 0.16);
      border: 1px solid rgba(248, 113, 113, 0.6);
      color: #fecaca;
    }

    .muted {
      color: #6b7280;
      font-size: 0.85rem;
    }

    .footer {
      margin-top: 18px;
      font-size: 0.8rem;
      color: #6b7280;
      text-align: right;
    }

    @media (max-width: 640px) {
      .container {
        margin: 12px;
        padding: 16px;
      }

      h1 {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <span class="logo"></span>
      Image Metadata Analyzer
    </h1>
    <p class="subtitle">
      Upload an image to inspect EXIF data, GPS location, device info and other hidden metadata.
    </p>

    <!-- Upload card -->
    <div class="card">
      <form id="analyzeForm">
        <div class="upload-row">
          <input type="file" id="imageInput" accept="image/*" />
          <button type="submit" id="analyzeBtn">
            üîç Analyze Metadata
          </button>
        </div>
      </form>
      <div id="status" class="status muted">No file analyzed yet.</div>
    </div>

    <!-- Basic info -->
    <div class="card" style="margin-top: 16px;">
      <h2 class="section-title">Basic Info</h2>
      <div id="basicInfo" class="grid">
        <div class="muted">Upload an image to see its basic properties.</div>
      </div>
    </div>

    <!-- Privacy flags -->
    <div class="card" style="margin-top: 16px;">
      <h2 class="section-title">Privacy Signals</h2>
      <div id="privacyFlags" class="grid">
        <div class="muted">
          We‚Äôll highlight if GPS, timestamps, or camera details are present in the metadata.
        </div>
      </div>
    </div>

    <!-- EXIF table -->
    <div class="card" style="margin-top: 16px;">
      <h2 class="section-title">Raw EXIF Metadata</h2>
      <div id="exifEmpty" class="muted">No metadata loaded.</div>
      <table id="exifTable" style="display: none;">
        <thead>
          <tr>
            <th style="width: 20%;">Tag</th>
            <th style="width: 65%;">Value</th>
            <th style="width: 15%;">Sensitive?</th>
          </tr>
        </thead>
        <tbody id="exifTableBody"></tbody>
      </table>
    </div>

    <div class="footer">
      Mini‚Äëproject: Metadata Cleaner & Analyzer
    </div>
  </div>

  <script>
    const form = document.getElementById("analyzeForm");
    const imageInput = document.getElementById("imageInput");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const statusEl = document.getElementById("status");
    const basicInfoEl = document.getElementById("basicInfo");
    const privacyFlagsEl = document.getElementById("privacyFlags");
    const exifEmptyEl = document.getElementById("exifEmpty");
    const exifTableEl = document.getElementById("exifTable");
    const exifTableBody = document.getElementById("exifTableBody");

    function setStatus(message, type = "muted") {
      statusEl.textContent = message;
      statusEl.className = "status " + type;
    }

    function renderBasicInfo(info) {
      if (!info) {
        basicInfoEl.innerHTML = '<div class="muted">No info available.</div>';
        return;
      }

      basicInfoEl.innerHTML = `
        <div class="info-item">
          <div class="info-label">File name</div>
          <div class="info-value">${info.file_name || "-"}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Format</div>
          <div class="info-value">${info.format || "-"}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Resolution</div>
          <div class="info-value">${info.resolution || "-"}</div>
        </div>
        <div class="info-item">
          <div class="info-label">File size</div>
          <div class="info-value">${info.file_size || "-"}</div>
        </div>
      `;
    }

    function renderPrivacyFlags(flags, gps) {
      if (!flags) {
        privacyFlagsEl.innerHTML = '<div class="muted">No privacy info.</div>';
        return;
      }

      const gpsBadge = flags.has_gps
        ? `<span class="badge badge-danger">üìç GPS data present</span>`
        : `<span class="badge badge-ok">üìç No GPS data</span>`;

      const timeBadge = flags.has_datetime
        ? `<span class="badge badge-warn">‚è±Ô∏è Timestamp present</span>`
        : `<span class="badge badge-ok">‚è±Ô∏è No timestamp</span>`;

      const cameraBadge = flags.has_camera_model
        ? `<span class="badge badge-warn">üì∑ Camera model present</span>`
        : `<span class="badge badge-ok">üì∑ No camera model</span>`;

      let gpsText = "";
      if (gps && gps.latitude != null && gps.longitude != null) {
        gpsText = `<div class="info-value">
            Lat: ${gps.latitude.toFixed(6)}, Lng: ${gps.longitude.toFixed(6)}<br/>
            <span class="muted">This can reveal where the photo was taken.</span>
          </div>`;
      } else {
        gpsText = `<div class="info-value muted">No precise GPS coordinates in metadata.</div>`;
      }

      privacyFlagsEl.innerHTML = `
        <div class="info-item">
          <div class="info-label">Location</div>
          <div>${gpsBadge}</div>
          ${gpsText}
        </div>
        <div class="info-item">
          <div class="info-label">Time</div>
          <div class="info-value">
            ${timeBadge}<br/>
            <span class="muted">Timestamps can reveal when the image was taken.</span>
          </div>
        </div>
        <div class="info-item">
          <div class="info-label">Device</div>
          <div class="info-value">
            ${cameraBadge}<br/>
            <span class="muted">Device info can reveal camera / phone model.</span>
          </div>
        </div>
      `;
    }

    function renderExifTable(exifList) {
      if (!exifList || exifList.length === 0) {
        exifEmptyEl.style.display = "block";
        exifEmptyEl.textContent = "No EXIF metadata found in this image.";
        exifTableEl.style.display = "none";
        exifTableBody.innerHTML = "";
        return;
      }

      exifEmptyEl.style.display = "none";
      exifTableEl.style.display = "table";
      exifTableBody.innerHTML = "";

      exifList.forEach((item) => {
        const tr = document.createElement("tr");

        const tagTd = document.createElement("td");
        tagTd.innerHTML = `<span class="tag-name">${item.tag}</span>`;

        const valTd = document.createElement("td");
        valTd.textContent = item.value;

        const sensTd = document.createElement("td");
        if (item.is_sensitive) {
          sensTd.innerHTML =
            '<span class="sensitive-pill">‚ö†Ô∏è Sensitive</span>';
        } else {
          sensTd.innerHTML = '<span class="muted">Normal</span>';
        }

        tr.appendChild(tagTd);
        tr.appendChild(valTd);
        tr.appendChild(sensTd);
        exifTableBody.appendChild(tr);
      });
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const file = imageInput.files[0];
      if (!file) {
        setStatus("Please select an image first.", "error");
        return;
      }

      const formData = new FormData();
      formData.append("image", file);

      analyzeBtn.disabled = true;
      setStatus("Analyzing metadata...", "muted");

      try {
        const response = await fetch("/analyze", {
          method: "POST",
          body: formData,
        });

        const data = await response.json();

        if (!response.ok || !data.success) {
          const msg = data.error || "Failed to analyze image.";
          setStatus(msg, "error");
          return;
        }

        setStatus(data.message || "Analysis complete.", "ok");
        renderBasicInfo(data.basic_info);
        renderPrivacyFlags(data.privacy_flags, data.gps);
        renderExifTable(data.exif);
      } catch (err) {
        console.error(err);
        setStatus("Unexpected error while analyzing image.", "error");
      } finally {
        analyzeBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
